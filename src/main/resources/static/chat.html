<!doctype html>
<html lang="en">

	<head>
		<meta charset="UTF-8" />
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<title>jiaxiao</title>
		<link rel="stylesheet" type="text/css" href="css/chat.css" />

		<script src="js/jquery.min.js"></script>
		<script src="js/flexible.js"></script>
		<script src="js/chat.js" type="text/javascript" charset="utf-8"></script>
	</head>

	<body>
		<header class="header">
			<a class="back" href="javascript:history.back()"></a>
			<h5 class="tit">聊天</h5>
		</header>
		<div class="message">
		</div>
		<div class="footer">
			<img src="images/hua.png" alt="" />
			<input type="text"  />
			<p>发送</p>
		</div>

	</body>
	<script type="text/javascript">
		var websocket =null;
		var user = UrlParam.paramValues("name");
		if ('WebSocket' in window) {
			websocket = new WebSocket("ws://localhost:8080/websocket/"+user);
		}
		else {
			alert('当前浏览器不支持websocket')
		}


		//连接发生错误的回调方法
		websocket.onerror = function () {
			console.log("Websocket连接错误");
		};

		//连接成功建立的回调方法
		websocket.onopen = function () {
			console.log("WebSocket连接成功");
			show("images/touxiangm.png", "WebSocket连接成功");
		};

		//接收到消息的回调方法
		websocket.onmessage = function (event) {
			send("images/touxiangm.png", event.data);
		};

		websocket.onclose = function () {
			console.log("关闭Websocket");
		};

		//监听窗口关闭事件，当窗口关闭时，主动去关闭websocket连接，防止连接还没断开就关闭窗口，server端会抛异常。
		window.onbeforeunload = function () {
			closeWebSocket();
		};

		//关闭WebSocket连接
		function closeWebSocket() {
			websocket.close();
		}

	</script>
</html>